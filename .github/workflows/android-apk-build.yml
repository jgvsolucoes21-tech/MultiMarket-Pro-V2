# Workflow para construir y empaquetar una aplicación Capacitor Android (.apk) - Intento simplificado

name: Build Android APK (Capacitor)

on:
  push:
    branches:
      - main
      - master 
  workflow_dispatch: 

permissions:
  contents: read

jobs:
  build_apk:
    runs-on: ubuntu-latest

      # 3. Instalación de Dependencias (Ahora incluye Capacitor CLI)
      - name: Install All Dependencies (including Capacitor)
        run: npm install

      # 4. Compilación del Código Web (React Build)
      - name: Run Web Build
        run: npm run build

      # 5. Crear la Carpeta Nativa Android (Capacitor)
      # Esto fallará si la app no está iniciada correctamente, pero el '|| true' la mantiene viva
      - name: Add Android Platform
        run: npx cap add android || true 
        
      # 6. Sincronizar el Build Web con el Proyecto Android Nativo
      - name: Sync Web Assets to Android Project
        run: npx cap sync android

      # 7. Configurar el SDK de Android
      - name: Set up Android SDK
        uses: android-actions/setup-android@v3
        
      # 8. Construcción del Proyecto Android con Gradle
      - name: Build Android Debug APK
        run: cd android && ./gradlew assembleDebug

      # 9. Archivar y Subir el APK
      - name: Upload Debug APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: MiAppDespacho-Debug-APK
          path: android/app/build/outputs/apk/debug/app-debug.apk
          retention-days: 5
